{"ast":null,"code":"import _slicedToArray from\"D:/\\u524D\\u7AEF/\\u9879\\u76EE/cms-hcj/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useEffect,useState}from'react';import'./less/Means.less';import{Button,Form,Input,message,Upload}from'antd';import{LoadingOutlined,PlusOutlined}from'@ant-design/icons';import{GetInfoApi,ChangeUserDataApi}from'../request/api';import{connect}from'react-redux';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var getBase64=function getBase64(img,callback){var reader=new FileReader();reader.addEventListener('load',function(){return callback(reader.result);});reader.readAsDataURL(img);};var beforeUpload=function beforeUpload(file){var isJpgOrPng=file.type==='image/jpeg'||file.type==='image/png';if(!isJpgOrPng){message.error('You can only upload JPG/PNG file!');}// Byte  Kb Mb Tb\nvar isLt2M=file.size/1024<200;if(!isLt2M){message.error('Image must smaller than 200MB!');}return isJpgOrPng&&isLt2M;};function Means(props){// const [password,setPassWord] = useState('')\nvar _useState=useState(false),_useState2=_slicedToArray(_useState,2),loading=_useState2[0],setLoading=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),imageUrl=_useState4[0],setImageUrl=_useState4[1];useEffect(function(){GetInfoApi().then(function(res){if(res.errCode===0){// setXxx是异步的\n// setU_Name(res.data.username)\n// // setPassWord(res.data.password)\n// setAvatar(res.data.avatar)\n// 存到sessionStorage\nsessionStorage.setItem('username',res.data.username);sessionStorage.setItem('avatar',res.data.avatar);}});},[]);var onFinish=function onFinish(values){console.log(values);// 对比sessionStorage\n// 如果表单的username有值，并且不等于初始化拿到的username\nif(values.username&&values.username!==sessionStorage.getItem('username')&&values.password.trim()!==''){ChangeUserDataApi({username:values.username,password:values.password}).then(function(res){console.log(res);// 当修改成功后记得修改Header\n});}else{message.error('请检查输入');}};var handleChange=function handleChange(info){if(info.file.status==='uploading'){setLoading(true);return;}// 上传成功\nif(info.file.status==='done'){// Get this url from response in real world.\nvar res=info.file.response;if(res.errCode===0){message.success(res.message);getBase64(info.file.originFileObj,function(url){setLoading(false);setImageUrl(url);// 存头像\nlocalStorage.setItem(\"avatar\",res.data.filePath);// 触发reduce\nprops.addAvatarTag();});}else{setLoading(false);setImageUrl();message.error(res.message);}}if(info.file.status==='error'){message.error(info.file.response);setLoading(false);setImageUrl();}};var uploadButton=/*#__PURE__*/_jsxs(\"div\",{children:[loading?/*#__PURE__*/_jsx(LoadingOutlined,{}):/*#__PURE__*/_jsx(PlusOutlined,{}),/*#__PURE__*/_jsx(\"div\",{style:{marginTop:8},children:\"\\u4E0A\\u4F20\\u5934\\u50CF\"})]});return/*#__PURE__*/_jsxs(\"div\",{className:\"means\",children:[/*#__PURE__*/_jsxs(Form,{name:\"basic\",style:{width:'400px'},initialValues:{},onFinish:onFinish,autoComplete:\"off\",children:[/*#__PURE__*/_jsx(Form.Item,{label:\"\\u4FEE\\u6539\\u7528\\u6237\\u540D: \",name:\"username\",children:/*#__PURE__*/_jsx(Input,{})}),/*#__PURE__*/_jsx(Form.Item,{label:\"\\u4FEE \\u6539 \\u5BC6 \\u7801: \",name:\"password\",children:/*#__PURE__*/_jsx(Input.Password,{})}),/*#__PURE__*/_jsx(Form.Item,{children:/*#__PURE__*/_jsx(Button,{type:\"primary\",htmlType:\"submit\",style:{float:'right'},children:\"\\u4FEE\\u6539\"})})]}),/*#__PURE__*/_jsx(Upload,{name:\"avatar\",listType:\"picture-card\",className:\"avatar-uploader\",showUploadList:false// action=\"https://www.mocky.io/v2/5cc8019d300000980a055e76\"\n// 后端\n,action:'/api/upload',headers:{'cms-token':localStorage.getItem('cms-token')},beforeUpload:beforeUpload,onChange:handleChange,children:imageUrl?/*#__PURE__*/_jsx(\"img\",{src:imageUrl,alt:\"avatar\",style:{width:'100%'}}):uploadButton})]});}var mapDispatchToProps=function mapDispatchToProps(dispatch){return{addAvatarTag:function addAvatarTag(){var action={type:'addAvatarTag'};dispatch(action);}};};export default connect(null,mapDispatchToProps)(Means);","map":{"version":3,"names":["React","useEffect","useState","Button","Form","Input","message","Upload","LoadingOutlined","PlusOutlined","GetInfoApi","ChangeUserDataApi","connect","getBase64","img","callback","reader","FileReader","addEventListener","result","readAsDataURL","beforeUpload","file","isJpgOrPng","type","error","isLt2M","size","Means","props","loading","setLoading","imageUrl","setImageUrl","then","res","errCode","sessionStorage","setItem","data","username","avatar","onFinish","values","console","log","getItem","password","trim","handleChange","info","status","response","success","originFileObj","url","localStorage","filePath","addAvatarTag","uploadButton","marginTop","width","float","mapDispatchToProps","dispatch","action"],"sources":["D:/前端/项目/cms-hcj/src/pages/Means.jsx"],"sourcesContent":["import React, { useEffect, useState } from 'react'\r\nimport './less/Means.less'\r\n\r\nimport { Button, Form, Input, message, Upload } from 'antd';\r\nimport { LoadingOutlined, PlusOutlined } from '@ant-design/icons';\r\nimport { GetInfoApi, ChangeUserDataApi } from '../request/api';\r\nimport { connect } from 'react-redux';\r\n\r\nconst getBase64 = (img, callback) => {\r\n  const reader = new FileReader();\r\n  reader.addEventListener('load', () => callback(reader.result));\r\n  reader.readAsDataURL(img);\r\n};\r\nconst beforeUpload = (file) => {\r\n  const isJpgOrPng = file.type === 'image/jpeg' || file.type === 'image/png';\r\n  if (!isJpgOrPng) {\r\n    message.error('You can only upload JPG/PNG file!');\r\n  }\r\n  // Byte  Kb Mb Tb\r\n  const isLt2M = file.size / 1024  < 200;\r\n  if (!isLt2M) {\r\n    message.error('Image must smaller than 200MB!');\r\n  }\r\n  return isJpgOrPng && isLt2M;\r\n};\r\n\r\n\r\n function Means(props) {\r\n  // const [password,setPassWord] = useState('')\r\n  const [loading, setLoading] = useState(false);\r\n  const [imageUrl, setImageUrl] = useState();\r\n\r\n  useEffect(() => {\r\n    GetInfoApi().then(res => {\r\n      if (res.errCode === 0) {\r\n        // setXxx是异步的\r\n        // setU_Name(res.data.username)\r\n        // // setPassWord(res.data.password)\r\n        // setAvatar(res.data.avatar)\r\n        // 存到sessionStorage\r\n        sessionStorage.setItem('username', res.data.username)\r\n        sessionStorage.setItem('avatar', res.data.avatar)\r\n      }\r\n    })\r\n  }, [])\r\n\r\n  const onFinish = (values) => {\r\n    console.log(values)\r\n    // 对比sessionStorage\r\n    // 如果表单的username有值，并且不等于初始化拿到的username\r\n    if (values.username && values.username !== sessionStorage.getItem('username') && values.password.trim() !== '') {\r\n      ChangeUserDataApi({\r\n        username: values.username,\r\n        password: values.password,\r\n      }).then(res => {\r\n        console.log(res)\r\n        // 当修改成功后记得修改Header\r\n      })\r\n    } else {\r\n      message.error('请检查输入')\r\n    }\r\n  }\r\n\r\n  const handleChange = (info) => {\r\n    if (info.file.status === 'uploading') {\r\n      setLoading(true);\r\n      return;\r\n    }\r\n    // 上传成功\r\n    if (info.file.status === 'done') {\r\n      // Get this url from response in real world.\r\n      const res = info.file.response\r\n      if (res.errCode === 0) {\r\n        message.success(res.message)\r\n        getBase64(info.file.originFileObj, (url) => {\r\n          setLoading(false);\r\n          setImageUrl(url);\r\n          // 存头像\r\n          localStorage.setItem(\"avatar\",res.data.filePath)\r\n          // 触发reduce\r\n          props.addAvatarTag()\r\n        });\r\n      }else{\r\n        setLoading(false);\r\n        setImageUrl()\r\n        message.error(res.message)\r\n      }\r\n    }\r\n    if(info.file.status === 'error'){\r\n      message.error(info.file.response)\r\n      setLoading(false)\r\n      setImageUrl();\r\n    }\r\n  };\r\n  const uploadButton = (\r\n    <div>\r\n      {loading ? <LoadingOutlined /> : <PlusOutlined />}\r\n      <div\r\n        style={{\r\n          marginTop: 8,\r\n        }}\r\n      >\r\n        上传头像\r\n      </div>\r\n    </div>\r\n  );\r\n  return (\r\n    <div className=\"means\">\r\n      <Form\r\n        name=\"basic\"\r\n        style={{\r\n          width: '400px'\r\n        }}\r\n        initialValues={{\r\n        }}\r\n        onFinish={onFinish}\r\n        autoComplete=\"off\"\r\n      >\r\n        <Form.Item\r\n          label=\"修改用户名: \"\r\n          name=\"username\"\r\n        >\r\n          <Input />\r\n        </Form.Item>\r\n\r\n        <Form.Item\r\n          label=\"修 改 密 码: \"\r\n          name=\"password\"\r\n        >\r\n          <Input.Password />\r\n        </Form.Item>\r\n\r\n        <Form.Item>\r\n          <Button type=\"primary\" htmlType=\"submit\" style={{\r\n            float: 'right'\r\n          }}>\r\n            修改\r\n          </Button>\r\n        </Form.Item>\r\n      </Form>\r\n\r\n      {/* 图片上传 */}\r\n      <Upload\r\n        name=\"avatar\"\r\n        listType=\"picture-card\"\r\n        className=\"avatar-uploader\"\r\n        showUploadList={false}\r\n        // action=\"https://www.mocky.io/v2/5cc8019d300000980a055e76\"\r\n        // 后端\r\n        action={'/api/upload'}\r\n        headers={{\r\n          'cms-token':localStorage.getItem('cms-token')\r\n        }}\r\n        beforeUpload={beforeUpload}\r\n        onChange={handleChange}\r\n      >\r\n        {imageUrl ? (\r\n          <img\r\n            src={imageUrl}\r\n            alt=\"avatar\"\r\n            style={{\r\n              width: '100%',\r\n            }}\r\n          />\r\n        ) : (\r\n          uploadButton\r\n        )}\r\n      </Upload>\r\n    </div>\r\n  );\r\n}\r\n\r\nconst mapDispatchToProps = (dispatch)=>{\r\n  return{\r\n    addAvatarTag(){\r\n      const action = {\r\n        type:'addAvatarTag'\r\n      }\r\n      dispatch(action)\r\n    }\r\n  }\r\n}\r\n\r\nexport default connect(null,mapDispatchToProps)(Means)"],"mappings":"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"},"metadata":{},"sourceType":"module"}